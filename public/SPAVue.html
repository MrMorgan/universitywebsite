<html>
<head>
<title>A very simple SPA in Vue</title>
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous"></script>
</head>
<body>

<div id="Itemlist">
    <button v-on:click="doajax('courses')">Courses</button>
    <button v-on:click="doajax('students')">Students</button>
    <button v-on:click="setsections()">Sections</button>
    <table id="courseTable">
        <thead>
        <tr>
            <td>Name</td>
            <th colspan="3"></th>
        </tr>
        </thead>
        <tr v-for="item in items">
            <td>{{item.name}}</td>
            <td>{{item.department}}</td>
            <td>{{item.number}}</td>
            <td>{{item.credits}}</td>
            <td>{{item.course_name}}</td>
        </tr>
    </table>
</div>

<script type="text/javascript">
var ItemsVue = new Vue({
    el: '#Itemlist',
    data: { items: [],
            columns: []},
    methods: {
        // use jquery
        doajax: function(which) {
            return $.ajax({
                url: 'http://localhost:3000/' + which + '.json',
                method: 'GET',
                // use => so the this is not set
                success: (d) => {
                    this.items = d;
                },
                error: function (error) {
                    console.log(error);
                }
            });
        },
        fetchajax: function(which, handler){
            $.ajax({
                        url: 'http://localhost:3000/' + which + '.json',
                        method: 'GET',
                        // use => so the this is not set
                        success: (d) => {
                            handler(d);
                        },
                        error: function (error) {
                            console.log(error);
                        }
            });
        },
        setsections: function(){
            ItemsVue.doajax('sections').then(function(data){
            ItemsVue.items.forEach(function(item, index){
                ItemsVue.fetchajax('courses/' + item.course_id, function(data){Vue.set(ItemsVue.items[index], 'name', data.name) });
            });
        });
        }
    }
});
</script>

</body>
</html>
